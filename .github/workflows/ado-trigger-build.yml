name: Trigger ADO Build Pipeline

on:
  push:
    branches:
      - main

jobs:
  trigger-pipeline:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Trigger Azure DevOps Pipeline
        env:
          ADO_ORG: "UnipharGroup"
          ADO_PROJECT: "DAWN-dev"          
        run: |
          # Set variables
          ADO_URL="https://dev.azure.com/${ADO_ORG}/${ADO_PROJECT}/_apis/wit/workItems/34424/comments?api-version=7.1-preview.3"          
          # Trigger the pipeline
          # JSON data to be sent
          json_data='{"text": "Code Updated"}'
          
          # Make the API request and capture the response
          response=$(curl -X POST "$ADO_URL" \
            -H "Content-Type: application/json" \
            -H "Authorization: Basic OjN3bXI0aHFxamNiY3AybjJ6dXM3ZWpxZ3Rrc2FoZmFpc2FqcHF1bzR1eGtvMnN2N2Z0cXE=" \
            -d "$json_data" \
            -w "%{http_code}" -o response_body.txt -s)
                    
          # Output HTTP status code and response body
          echo "HTTP Status Code: ${response}"
          echo "Response Body:"
          cat response_body.txt
